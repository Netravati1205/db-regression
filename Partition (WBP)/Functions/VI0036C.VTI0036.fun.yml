Function:
  Enabled For RDMLX:  Yes

  Source: |
    Function Options(*DIRECT) Rcv_List(#wLKData #wLRet)
    
    * ******************************************************************************************************
    * Test Case Description
    * Issue #36 Test the OAM after importing of the table definition into LANSA
    * ******************************************************************************************************
    
    * Unique Key Data.
    Def_List Name(#wLKData) Fields(#VTF_KEY1 #VTF_KEY2 #VTF_KEY3) Type(*WORKING) Entrys(1)
    
    * Return messages.
    Def_List Name(#wLRet) Fields(#BIFMSGC #BIFMSG1 #BIFMSG2) Counter(#BIFMSGCNT) Type(*WORKING) Entrys(*MAX)
    
    Define Field(#LF_rc) Reffld(#BIFA002A)
    Define Field(#LF_DB_Type) Type(*CHAR) Length(32)
    Define Field(#LF_i) Reffld(#Std_Count)
    Define Field(#LF_Original_Count) Reffld(#Std_Count)
    Define Field(#LF_DB_Count) Reffld(#Std_Count)
    Define Field(#LF_DataShown) Reffld(#BIFB001B)
    
    * Local Copies of Table Columns - matches following List fields
    Define Field(#LF_V_ID) Reffld(#V_ID)
    Define Field(#LF_V_NAME) Reffld(#V_NAME)
    Define Field(#LF_V_SURNAME) Reffld(#V_SURNAME)
    Define Field(#LF_V_LASTNAME) Reffld(#V_LASTNAME)
    Define Field(#LF_V_DATE) Reffld(#V_DATE)
    Define Field(#LF_V_SALARY) Reffld(#V_SALARY)
    Define Field(#LF_V_ACTIVE) Reffld(#V_ACTIVE)
    Define Field(#LF_V_DESC) Reffld(#V_DESC)
    Define Field(#LF_V_TAG) Reffld(#V_TAG)
    Define Field(#LF_V_TIME) Reffld(#V_TIME)
    Define Field(#LF_V_RAWDATA) Reffld(#V_RAWDATA)
    Define Field(#LF_V_DATA) Reffld(#V_DATA)
    Define Field(#LF_V_CODE) Reffld(#V_CODE)
    Define Field(#LF_V_xml) Reffld(#V_xml)
    
    * #XG_ALL includes all Fields in the Table
    Group_By Name(#XG_ALL) Fields(#V_ID #V_NAME #V_SURNAME #V_LASTNAME #V_ACTIVE #V_CODE #V_DATE #V_DESC #V_DATA #V_RAWDATA #V_SALARY #V_TAG #V_TIME #V_XML)
    
    Def_List Name(#w_lOriginal) Fields(#XG_ALL) Counter(#LF_Original_Count) Type(*WORKING)
    Def_List Name(#w_lDB) Fields(#XG_ALL) Counter(#LF_DB_Count) Type(*WORKING)
    
    Use Builtin(Get_Session_Value) With_Args(DBUT) To_Get(#LF_DB_Type #LF_rc)
    
    * Start testing.
    Clr_List Named(#wLRet)
    #Com_Owner.mthAdd_Msg( OK *Function ('Start - ' + *Function_Desc) )
    
    Get_Entry Number(1) From_List(#wLKData)
    
    *
    * Add your test case here
    * It should be a list of method calls so its easy to read whats being tested.
    #Com_Owner.mthClearData( #LF_rc )
    
    If (#LF_rc *EQ OK)
    #Com_Owner.mthInsert( #LF_rc )
    Endif
    
    If (#LF_rc *EQ OK)
    #Com_Owner.mthUpdate( #LF_rc )
    Endif
    
    If (#LF_rc *EQ OK)
    #Com_Owner.mthSelect( #LF_rc )
    Endif
    
    #Com_Owner.mthAdd_Msg( #LF_rc *Function 'End' )
    Use Builtin(CLR_MESSAGES)
    Return
    
    * Add a message to the Return Message List.
    Mthroutine Name(mthAdd_Msg)
    Define_Map For(*INPUT) Class(#BIFMSGC) Name(#this_msg_code)
    Define_Map For(*INPUT) Class(#BIFMSG1) Name(#this_msg1)
    Define_Map For(*INPUT) Class(#BIFMSG2) Name(#this_msg2)
    
    #BIFMSGC := #this_msg_code
    #BIFMSG1 := #this_msg1
    #BIFMSG2 := #this_msg2
    Add_Entry To_List(#wLRet)
    Endroutine
    
    * Add a sub message to the Return Message List.
    Mthroutine Name(mthAdd_SubMsg)
    Define_Map For(*INPUT) Class(#BIFMSGC) Name(#this_msg_code)
    Define_Map For(*INPUT) Class(#BIFMSG1) Name(#this_msg1)
    Define_Map For(*INPUT) Class(#BIFMSG2) Name(#this_msg2)
    
    #BIFMSGC := #this_msg_code
    #BIFMSG1 := ' ' + #this_msg1
    #BIFMSG2 := #this_msg2
    Add_Entry To_List(#wLRet)
    Endroutine
    
    *
    * Log the runtime messages produced by BIFs.
    * N.B. Only expected to be called when there is an error.
    * If it was always called the log would be swamped with irrelevant messages
    *
    Mthroutine Name(mthIssue_Runtime_Message) Options(*RECEIVES_MESSAGES)
    Define_Map For(*INPUT) Class(#BIFA002A) Name(#this_rc)
    
    Define Field(#LF_msg_rc) Reffld(#BIFA002A) Default(OK)
    Define Field(#LF_msg_text) Reffld(#BIFMSG1)
    
    Dowhile Cond(#LF_msg_rc = OK)
    Use Builtin(GET_MESSAGE) To_Get(#LF_msg_rc #LF_msg_text)
    If Cond(#LF_msg_rc = OK)
    #Com_Owner.mthAdd_SubMsg( #this_rc (#LF_msg_text) ('') )
    Endif
    Endwhile
    Endroutine
    
    *
    *
    *
    Mthroutine Name(mthClearData)
    Define_Map For(*BOTH) Class(#BIFA002A) Name(#this_rc)
    
    #Com_Owner.mthAdd_SubMsg( OK 'Clear Data' '' )
    
    Clr_List Named(#w_lOriginal)
    Clr_List Named(#w_lDB)
    
    Select Fields(#V_ID) From_File(VTLI0036A) Io_Status(#this_rc) Io_Error(*NEXT) Val_Error(*NEXT)
    Add_Entry To_List(#w_lOriginal)
    Endselect
    
    If (#this_rc = EF)
    #this_rc := OK
    #Com_Owner.mthAdd_SubMsg( OK ('- ' + #LF_Original_Count.AsString + ' record(s) found') '' )
    
    If (#LF_Original_Count > 0)
    Begin_Loop Using(#LF_i) To(#LF_Original_Count)
    Get_Entry Number(#LF_i) From_List(#w_lOriginal)
    
    Delete From_File(VTLI0036A) With_Key(#V_ID) Io_Status(#this_rc) Io_Error(*NEXT) Val_Error(*NEXT)
    If (#this_rc <> OK)
    #Com_Owner.mthIssue_Runtime_Message( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Unexpected ' + #this_rc) ('Deleting on record ' + #V_ID.AsString) )
    #this_rc := ER
    Leave
    Endif
    End_Loop
    
    If (#this_rc = OK)
    #Com_Owner.mthAdd_SubMsg( OK ('- Successful') '' )
    Endif
    Endif
    Else
    #Com_Owner.mthAdd_SubMsg( ER ('- Unexpected ' + #this_rc) '' )
    #this_rc := ER
    Endif
    
    Clr_List Named(#w_lOriginal)
    Endroutine
    
    *
    *
    *
    Mthroutine Name(mthInsert)
    Define_Map For(*BOTH) Class(#BIFA002A) Name(#this_rc)
    Define Field(#LF_TagValue) Reffld(#V_TAG)
    
    * Create Test Data list
    
    #LF_i := 1
    #V_ID := #LF_i
    #LF_i += 1
    #V_NAME := 'TESTER'
    #V_SURNAME := 'TTT'
    #V_LASTNAME := 'LLL'
    #V_DATE := *DATE
    #V_TIME := *TIME
    #V_SALARY := 10000
    #V_ACTIVE := 1
    #V_DATA := 'Stored Data'
    #V_CODE := 1234567897
    #V_xml := *Sqlnull
    #V_RAWDATA := 'RAWDATA'
    #V_DESC := *SYS_DIR + 'x_txtfra.dat'
    #V_TAG := #LF_TagValue
    
    Add_Entry To_List(#w_lOriginal)
    
    #V_ID := #LF_i
    #LF_i += 1
    #V_NAME := 'Hello'
    #V_SURNAME := 'World'
    #V_LASTNAME := 'MR'
    #V_DATE := *DATE
    #V_TIME := *TIME
    #V_SALARY := 23232
    #V_ACTIVE := 0
    #V_DATA := 'My Data'
    #V_CODE := 1234567897
    #V_xml := *Sqlnull
    #V_RAWDATA := 'TestData'
    #V_DESC := *SYS_DIR + 'x_txtfra.dat'
    #V_TAG := #LF_TagValue
    
    Add_Entry To_List(#w_lOriginal)
    
    #Com_Owner.mthAdd_SubMsg( OK ('Insert: ' + #LF_Original_Count.AsString + ' record(s)') '' )
    
    Selectlist Named(#w_lOriginal)
    Insert Fields(*ALL) To_File(VTLI0036A) Io_Status(#this_rc) Io_Error(*NEXT) Val_Error(*NEXT)
    If (#this_rc <> OK)
    #Com_Owner.mthIssue_Runtime_Message( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Unexpected ' + #this_rc) ('Inserting record ' + #V_ID.AsString + ', ' + #BIFA256A) )
    Leave
    Endif
    Endselect
    
    If (#this_rc = OK)
    #Com_Owner.mthAdd_SubMsg( OK ('- Successful') '' )
    Endif
    Endroutine
    
    *
    * mthUpdate
    *
    Mthroutine Name(mthUpdate)
    Define_Map For(*BOTH) Class(#BIFA002A) Name(#this_rc)
    
    #Com_Owner.mthAdd_SubMsg( OK ('Update: ' + #LF_Original_Count.AsString + ' record(s)') '' )
    
    Selectlist Named(#w_lOriginal)
    #V_SURNAME := 'Update'
    Update Fields(*ALL) In_File(VTLI0036A) With_Key(#V_ID) Io_Status(#this_rc) Io_Error(*NEXT) Val_Error(*NEXT)
    If (#this_rc <> OK)
    #Com_Owner.mthIssue_Runtime_Message( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Unexpected ' + #this_rc) ('Updating record ' + #V_ID.AsString + ', ' + #V_SURNAME) )
    Leave
    Endif
    Endselect
    
    If (#this_rc = OK)
    #Com_Owner.mthAdd_SubMsg( OK ('- Successful') '' )
    Endif
    Endroutine
    
    *
    * mthSelect
    *
    Mthroutine Name(mthSelect)
    Define_Map For(*BOTH) Class(#BIFA002A) Name(#this_rc)
    
    #Com_Owner.mthAdd_SubMsg( OK ('Compare: ' + #LF_Original_Count.AsString + ' record(s)') '' )
    
    Clr_List Named(#w_lDB)
    Select Fields(*ALL) From_File(VTLI0036A) Io_Status(#this_rc) Io_Error(*NEXT) Val_Error(*NEXT)
    Add_Entry To_List(#w_lDB)
    Endselect
    
    If (#this_rc *EQ ER)
    #Com_Owner.mthIssue_Runtime_Message( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Unexpected ' + #this_rc) ('Selecting record ' + #LF_DB_Count.AsString) )
    Return
    Endif
    
    If (#LF_Original_Count *NE #LF_DB_Count)
    #Com_Owner.mthAdd_SubMsg( ER ('- Expected # rows ' + #LF_Original_Count.asString) ('Actual rows ' + #LF_DB_Count.AsString) )
    Return
    Endif
    
    #LF_i := 1
    Selectlist Named(#w_lOriginal)
    #LF_V_ID := #V_ID
    #LF_V_NAME := #V_NAME
    * #LF_V_SURNAME := #V_SURNAME
    #LF_V_LASTNAME := #V_LASTNAME
    #LF_V_DATE := #V_DATE
    #LF_V_SALARY := #V_SALARY
    #LF_V_ACTIVE := #V_ACTIVE
    #LF_V_TAG := #V_TAG
    #LF_V_TIME := #V_TIME
    #LF_V_RAWDATA := #V_RAWDATA
    #LF_V_DATA := #V_DATA
    #LF_V_CODE := #V_CODE
    #LF_V_xml := #V_xml
    
    Get_Entry Number(#LF_i) From_List(#w_lDB) Ret_Status(#this_rc)
    If (#this_rc <> OK)
    #Com_Owner.mthIssue_Runtime_Message( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Unexpected ' + #this_rc) ('Entry Number ' + #LF_i.AsString + ' may not exist in list LF_lDB') )
    Leave
    Endif
    
    * Compare all the fields in the 2 lists
    #LF_DataShown := False
    
    * Debug line - needs to be removed once the test is fully working
    * #Com_Owner.mthShowData( #this_rc )
    
    If (#LF_V_ID <> #V_ID)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #LF_V_ID data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_NAME <> #V_NAME)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #LF_V_NAME data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_SURNAME <> #V_SURNAME)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_SURNAME data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_LASTNAME <> #V_LASTNAME)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_LASTNAME data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_DATE <> #V_DATE)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_DATE data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_SALARY <> #V_SALARY)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_SALARY data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_ACTIVE <> #V_ACTIVE)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_ACTIVE data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_DESC <> #V_DESC)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_DESC data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_TAG <> #V_TAG)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_TAG data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_TIME <> #V_TIME)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_TIME data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_RAWDATA <> #V_RAWDATA)
    * #V_RAWDATA is an binary field, condition will not be valid only print the original and DB value
    * #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( OK ('- Field Original #V_RAWDATA data ' + #V_RAWDATA.AsString) '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- Field DB #LF_V_RAWDATA data ' + #LF_V_RAWDATA.AsString) '' )
    Endif
    If (#LF_V_DATA <> #V_DATA)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_DATA data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_CODE <> #V_CODE)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_CODE data mismatch') '' )
    #this_rc := ER
    Endif
    If (#LF_V_xml <> #V_xml)
    #Com_Owner.mthShowData( #this_rc )
    #Com_Owner.mthAdd_SubMsg( ER ('- Field #V_xml data mismatch') '' )
    #this_rc := ER
    Endif
    
    If (#this_rc <> OK)
    #Com_Owner.mthAdd_SubMsg( ER ('- Unexpected ' + #this_rc) ('Comparing record ' + #V_ID.AsString + ', ' + #BIFA256A) )
    Leave
    Endif
    
    #LF_i += 1
    Endselect
    
    If (#this_rc = OK)
    #Com_Owner.mthAdd_SubMsg( OK ('- Successful') '' )
    Endif
    Endroutine
    
    *
    * mthShowData
    *
    Mthroutine Name(mthShowData)
    Define_Map For(*BOTH) Class(#BIFA002A) Name(#this_rc)
    
    If (*Not #LF_DataShown)
    #LF_DataShown := True
    #Com_Owner.mthAdd_SubMsg( OK ('- data mismatch on Entry Number ' + #LF_i.AsString) ('') )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Real Fields') ('') )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original  #V_ID "' + #LF_V_ID.asString + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_ID "' + #V_ID.asString + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_NAME "' + #LF_V_NAME.AsNativeString + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_NAME "' + #V_NAME.AsNativeString + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_SURNAME "' + #LF_V_SURNAME + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_SURNAME "' + #V_SURNAME + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_LASTNAME "' + #LF_V_LASTNAME.AsNativeString + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_LASTNAME "' + #V_LASTNAME.AsNativeString + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_DATE  "' + #LF_V_DATE.asString + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_DATE "' + #V_DATE.asString + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_SALARY "' + #LF_V_SALARY.asString + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_SALARY "' + #V_SALARY.asString + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_ACTIVE "' + #LF_V_ACTIVE.asString + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_ACTIVE "' + #V_ACTIVE.asString + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_DESC "' + #LF_V_DESC + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_DESC "' + #V_DESC + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_TAG "' + #LF_V_TAG + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_TAG "' + #V_TAG + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_TIME "' + #LF_V_TIME.asString + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_TIME "' + #V_TIME.asString + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_RAWDATA "' + #LF_V_RAWDATA.asString + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_RAWDATA "' + #V_RAWDATA.asString + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_DATA "' + #LF_V_DATA + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_DATA "' + #V_DATA + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_CODE "' + #LF_V_CODE.AsString + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_CODE "' + #V_CODE.AsString + '"') '' )
    
    #Com_Owner.mthAdd_SubMsg( OK ('- Original #V_xml "' + #V_xml + '"') '' )
    #Com_Owner.mthAdd_SubMsg( OK ('- DB       #V_xml "' + #V_xml + '"') '' )
    Endif
    
    Endroutine
    
